!function(i,t){function u(){this.audio=new Audio,this.status="pause"}u.prototype={play:function(){this.audio.play(),this.status="play"},pause:function(){this.audio.pause(),this.status="pause"},curTime:function(i){return i?this.audio.currentTime=i:this.audio.currentTime},getAudio:function(i){this.audio.src=i,this.audio.loade}},t.AudioManager=u}(window.Zepto,window.player||(window.player={}));
!function(t,a){"use strict";(window.player||(window.player={})).blurImg=function(t,a){var e=t.width,r=t.height,o=document.createElement("canvas"),n=o.getContext("2d");o.width=50,o.height=50,n.drawImage(t,0,0,e,r,0,0,50,50);var i=n.getImageData(0,0,50,50);!function(t){var a,e,r,o,n,i,h,g,d,f,w=t.data,c=t.width,u=t.height,m=[],l=0,s=10;for(i=1/(5*Math.sqrt(2*Math.PI)),n=-.02,h=0,a=-s;a<=s;a++,h++)o=i*Math.exp(n*a*a),l+=m[h]=o;for(h=0,f=m.length;h<f;h++)m[h]/=l;for(e=0;e<u;e++)for(a=0;a<c;a++){for(r=o=n=i=0,l=0,g=-s;g<=s;g++)0<=(d=a+g)&&d<c&&(r+=w[h=4*(e*c+d)]*m[g+s],o+=w[h+1]*m[g+s],n+=w[h+2]*m[g+s],l+=m[g+s]);w[h=4*(e*c+a)]=10<r/l?r/l-10:0,w[h+1]=10<o/l?o/l-10:0,w[h+2]=10<n/l?n/l-10:0}for(a=0;a<c;a++)for(e=0;e<u;e++){for(r=o=n=i=0,l=0,g=-s;g<=s;g++)0<=(d=e+g)&&d<u&&(r+=w[h=4*(d*c+a)]*m[g+s],o+=w[h+1]*m[g+s],n+=w[h+2]*m[g+s],l+=m[g+s]);w[h=4*(e*c+a)]=10<r/l?r/l-10:0,w[h+1]=10<o/l?o/l-10:0,w[h+2]=10<n/l?n/l-10:0}}(i),n.putImageData(i,0,0);var h=o.toDataURL();a.css("background-image","url("+h+")")}}(window.Zepto);
var songList,audio,listMove,index=0,flag=!1,$ul=$(".list-content ul");function changeMusic(n){index=(index+n+songList.length)%songList.length,player.render(songList[index]),audio.getAudio(songList[index].audio),$(".play-btn").removeClass("play").addClass("pause"),$ul.find("li.active").removeClass("active"),$ul.find("li").eq(index).addClass("active"),player.progress.renderEndTime(songList[index].duration),audio.play(),flag||(flag=!0,player.progress.updata())}function bindEvent(){$(".control-btn").on("tap",".last",function(){changeMusic(-1)}).on("tap",".next",function(){changeMusic(1)}).on("tap",".play-btn",function(){"pause"==audio.status?(audio.play(),$(".play-btn").removeClass("play").addClass("pause"),flag||(flag=!0,player.progress.updata())):(audio.pause(),flag=!1,$(".play-btn").removeClass("pause").addClass("play"))}).on("tap",".list",function(){$(".song-list").css("display","block"),$(".song-list-bg").css("display","block")}),$(".song-list-bg").on("tap",function(){$(".song-list").css("display","none"),$(".song-list-bg").css("display","none")}),$ul.on("tap","li",function(n){changeMusic($(this).index()-index)}).on("touchstart",function(n){var t=n.touches[0].clientY,a=parseFloat($ul.css("top"));$(document).on("touchmove",function(n){var s=n.touches[0].clientY-t;$ul.css("top",a+s+"px")}).one("touchend",function(){var n=$ul.position().top,s=$ul.height(),t=$(".list-content").height();0<n||s<=t?$ul.css("top","0px"):n<t-s&&$ul.css("top",t-s+"px"),$(document).off("touchmove",listMove)})})}function getData(n){$.ajax({type:"GET",url:n,success:outData,error:function(){}})}function outData(n){songList=n,player.render(n[index]),player.renderList(n),$ul.find("li").eq(index).addClass("active"),bindEvent(),(audio=new player.AudioManager).getAudio(songList[index].audio),player.progress.renderEndTime(songList[index].duration)}getData("http://dwqc.gitee.io/mobile_web_music_player/dist/source/data.json");

!function(n,o){var i,t=n(".now-time").eq(0),a=n(".pro-top").eq(0),r=n(".pro-btn").eq(0),u=n(".pro-bottom").width(),c=n(document);function e(o){var n=0|o/60,t=0|o%60;return(n=n<10?"0"+n:n)+":"+(t=t<10?"0"+t:t)}function d(o){var n=o/durationTime;return n=1<=n?1:n,t.html(e(o)),a.css("transform","translate("+100*(n-1)+"% , -50%)"),r.css("transform","translate("+(u-8)*n+"px, -50%)"),o}r.on("touchstart",function(o){var t,a=o.touches[0].clientX,e=r.position().left,n=!1;"play"==audio.status&&(n=!0,audio.pause(),flag=!1),c.on("touchmove",function(o){var n=o.touches[0].clientX;d((t=(t=1<(t=(e+(n-a))/u)?1:t)<0?0:t)*durationTime)}).one("touchend",function(o){audio.curTime(t*durationTime),n&&(flag=!0,player.progress.updata(),audio.play()),c.off("touchmove",i)})}),o.progress={renderEndTime:function(o){durationTime=o,n(".end-time").html(e(durationTime))},updata:function o(){1==audio.audio.ended&&changeMusic(1);var n=requestAnimationFrame(function(){d(audio.curTime()),flag?o():cancelAnimationFrame(n)})}}}(window.Zepto,window.player||(window.player={}));
!function(a,o){o.render=function(n){var s,e,i,l;e='<h2 class="song">'+(s=n).song+'</h2>                    <p class = "singer">'+s.singer+'</p>                    <p class = "album">'+s.album+"</p>",a(".info").html(e),i=n.image,(l=new Image).src=i,l.onload=function(){o.blurImg(l,a(".wrapper")),a(".singer-pic").html(l)},n.isLike?a(".keep").removeClass("unlike").addClass("like"):a(".keep").removeClass("like").addClass("unlike")},o.renderList=function(n){var e=a(".song-list"),s=n;e.find(".top .len").html("("+s.length+"é¦–)"),s.forEach(function(n,s){e.find(".list-content ul").append('            <li><span class="song">'+n.song+' </span> <span class="singer"> - '+n.singer+"</span></li>            ")})}}(window.Zepto,window.player||(window.player={}));